MODULE LinPeerMethods_Mod
  USE Parameter_Mod
  USE LinearSolver_Mod

  IMPLICIT NONE

  TYPE LinP1Method_T
    INTEGER :: nStage
    REAL(RealKind), POINTER :: GammaLinPeer(:)
    REAL(RealKind), POINTER :: cLinPeer(:)
    REAL(RealKind), POINTER :: ULinPeer(:,:)
    REAL(RealKind), POINTER :: U0LinPeer(:,:)
    REAL(RealKind), POINTER :: A0LinPeer(:,:)
    REAL(RealKind), POINTER :: ALinPeer(:,:)
    REAL(RealKind), POINTER :: LUULinPeer(:,:)
    REAL(RealKind), POINTER :: LUU0LinPeer(:,:)
    INTEGER, POINTER :: PULinPeer(:)
    INTEGER, POINTER :: PU0LinPeer(:)
  END TYPE LinP1Method_T

  TYPE(LinP1Method_T) :: GeriLang5
  TYPE(LinP1Method_T) :: GeriLang4

  TYPE LinP2Method_T
    INTEGER :: nStage
    REAL(RealKind), POINTER :: GammaLinPeer(:)
    REAL(RealKind), POINTER :: cLinPeer(:)
    REAL(RealKind), POINTER :: GLinPeer(:,:)
    REAL(RealKind), POINTER :: HLinPeer(:,:)
    REAL(RealKind), POINTER :: BLinPeer(:,:)
    REAL(RealKind), POINTER :: ALinPeer(:,:)
    REAL(RealKind), POINTER :: RLinPeer(:,:)
    REAL(RealKind), POINTER :: SLinPeer(:,:)
    REAL(RealKind), POINTER :: LUGLinPeer(:,:)
    REAL(RealKind), POINTER :: LUALinPeer(:,:)
    INTEGER, POINTER :: PGLinPeer(:)
    INTEGER, POINTER :: PALinPeer(:)
  END TYPE LinP2Method_T
  
  TYPE R_T
    REAL(RealKind), POINTER :: x(:)
  END TYPE R_T

  REAL(RealKind), PRIVATE, POINTER :: GammaLinPeer(:)
  REAL(RealKind), PRIVATE, POINTER :: cLinPeer(:)
  REAL(RealKind), PRIVATE, POINTER :: ULinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: U0LinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: A0LinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: ALinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: LUULinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: LUU0LinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: V(:,:)
  REAL(RealKind), PRIVATE, POINTER :: VInv(:,:)
  INTEGER, PRIVATE, POINTER :: PU0LinPeer(:)
  INTEGER, PRIVATE, POINTER :: PULinPeer(:)
  REAL(RealKind), PRIVATE, POINTER :: GLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: HLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: BLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: RLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: SLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: LUGLinPeer(:,:)
  REAL(RealKind), PRIVATE, POINTER :: LUALinPeer(:,:)
  INTEGER, PRIVATE, POINTER :: PGLinPeer(:)
  INTEGER, PRIVATE, POINTER :: PALinPeer(:)

  TYPE(LinP2Method_T) :: Jebens
  TYPE(LinP2Method_T) :: JebensNeu
  TYPE(LinP2Method_T) :: JebensNeu1
  TYPE(LinP2Method_T) :: JebensNeu2
  TYPE(LinP2Method_T) :: ImplPeer2
  TYPE(LinP2Method_T) :: ImplPeer3
  TYPE(LinP2Method_T) :: JebRos
  TYPE(LinP2Method_T) :: JebRosRK3
  TYPE(LinP2Method_T) :: JebIEul
  TYPE(LinP2Method_T) :: JebWei
  TYPE(LinP2Method_T) :: JebWei5
  TYPE(LinP2Method_T) :: JebCon

CONTAINS

SUBROUTINE MethodsLinP

  INTEGER :: i,j,Info
  INTEGER :: ip,jp
  INTEGER :: nStage

  INTEGER :: ipStage,iStage
  INTEGER :: jpStage,jStage
  REAL(RealKind), ALLOCATABLE :: w(:)
  REAL(RealKind), ALLOCATABLE :: Aw(:)
  TYPE(R_T), POINTER :: LUw(:)

! Ros3AMF 
  nStage=2
  CALL AllocateMethP2(JebRos,nStage)
  GammaLinPeer=1.0d0/2.0d0+SQRT(3.0d0)/6.0d0
  cLinPeer=(/0.5d0,1.0d0/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0d0, 1.0d0,  &
  0.0d0, 1.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0d0, 2.0d0/3.0d0,   &
  0.0d0, 1.0d0/4.0d0/), &
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0d0, 0.0d0,         &
  3.0d0/4.0d0, 0.0d0/), &
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  GammaLinPeer(1)*0.0d0, GammaLinPeer(1)*(-1.0d0),      &
  GammaLinPeer(1)*0.0d0, GammaLinPeer(1)*1.0d0/2.0d0/), &
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  GammaLinPeer*0.0d0, GammaLinPeer(1)*0.0d0,            &
  GammaLinPeer*(-3.0d0/2.0d0), GammaLinPeer(1)*0.0d0/), &
  SHAPE = (/nStage,nStage/) ))

  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)

  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)

! Linear implicit Euler
  nStage=1
  CALL AllocateMethP2(JebIEul,nStage)
  GammaLinPeer=1.0d0
  cLinPeer(1)=1.0d0
  BLinPeer(1,1)=1.0d0 
  cLinPeer=(/1.0d0/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  1.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  1.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  -GammaLinPeer(1)/),&
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  GammaLinPeer(1)*0.0d0/),&
  SHAPE = (/nStage,nStage/) ))

  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)

  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)

!c=[-5.7773335257609537e-001
!    3.0026515336155035e-001
!    1.0000000000000000e+000];
!gamma=[4.2890523821343479e-001
!       4.2890523821343479e-001
!       4.2890523821343479e-001];
!B=[2.9849370979072865e-002  1.0110127004800935e+000 -4.0862071459166316e-002
!   1.8600165604776986e-001  3.4486496767408092e-001 -2.0859119767698941e-001
!  -7.8662273522080439e-002  4.0037906629742565e-001  2.6852004384020683e-001];
!S=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!    6.7772457395513863e-001  0.0000000000000000e+000  0.0000000000000000e+000
!    3.6800845100994328e-001  4.1754712374504621e-002  0.0000000000000000e+000];
!A=[ 1.5221778150165555e-001 -1.7490243196585575e-001  1.9948646295516817e-001
!   -1.1442134899891926e-001  2.5810574055617974e-001  4.1845013423323330e-001
!   -5.9414843559866849e-002  8.3741953087149990e-003  2.4330073986195674e-001];
!R=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!    6.6444976945271528e-001  0.0000000000000000e+000  0.0000000000000000e+000
!    8.6700490826766648e-004  1.1629972665721646e+000  0.0000000000000000e+000];
!G=[-2.3161138625337080e-001  1.6810388718372526e-001 -3.6539773914378920e-001
!    2.0773818063523614e-001 -2.1865257605351296e-001 -3.3841895710590575e-001
!   -4.4459796629430420e-002  7.0041764974013224e-002 -2.2411339532665692e-001];
!H=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!   -7.9571885689252275e-002  0.0000000000000000e+000  0.0000000000000000e+000
!    4.3379008984240719e-001 -6.6416390107376788e-001  0.0000000000000000e+000];


! Jebens
  nStage=2
  CALL AllocateMethP2(Jebens,nStage)
  GammaLinPeer=6.4685133983435650d-001
  cLinPeer=(/1.2926673561018760d-003,1.0000000000000000d+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   5.5290036305801317d-004, 9.9944709963694200d-001,  &
  -4.8561380606995957d-001, 1.4856138060699595d+000/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  2.7525624754268333d-004, 1.5695967553667038d-003,  &
  1.7139535143402024d-001,-7.0622126959111745d+002/),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0000000000000000d+000, 0.0000000000000000d+000,  &
  7.0656488817072818d+002, 0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   8.3724589168784902d-004,-6.4768858572604437d-001,   &
  -6.4644453674870417d-001, 9.9983936847396217d+002/), &
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   0.0000000000000000e+000, 0.0000000000000000e+000,   &
  -9.9983977527704781e+002, 0.0000000000000000e+000/), &
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)

! JebensNeu
  nStage=2
  CALL AllocateMethP2(JebensNeu,nStage)
  GammaLinPeer=6.6353628933578046d-001
  cLinPeer=(/5.8343730285895812d-001,1.0000000000000000d+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    -6.5548281888049675d-001,1.6554828188804969d+000,  &
    -1.1149142644177592d+000,2.1149142644177594d+000/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    -5.4510570102059064d-001,8.5549331291707598d-001, &
    -3.2033765722889562d-001,6.1833081626857966d-002/),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
     7.9407288253515507d-001,0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     9.2934827255555252d-001,-1.5928845618913330d+000,  &
     5.8215025367201567d-001,-5.2404223356499391d-001/),&
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
    -7.2164430944280222d-001,0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)


! JebensNeu1
  nStage=2
  CALL AllocateMethP2(JebensNeu1,nStage)
  GammaLinPeer=1.1641505847092211d+000
  cLinPeer=(/-8.4840735082651289d-002, 1.0000000000000000d+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    1.4702327716796995d+000,-4.7023277167969946d-001,  &
    1.7437562599333183d+000,-7.4375625993331829d-001/), &
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    7.9416668561308701d-001,7.1596098007587072d-001,&
    4.0264092442821403d-001,1.4365654057361916d+000 /),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
     1.0524914926666302d+000 ,0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     -9.1043217828747733d-002,-1.0731073668804734d+000, &
     9.9198832843925200d-001,-3.1933910916691124d+000 /),&
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
    1.0372521785206394d+000, 0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)

! JebensNeu2
  nStage=2
  CALL AllocateMethP2(JebensNeu2,nStage)
  GammaLinPeer=4.4848413207479115d-001
  cLinPeer=(/7.3522093234597363d-001, 1.0000000000000000d+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    3.0168630025702869d-001, 6.9831369974297131d-001, &
   -6.6978125094895624d-001, 1.6697812509489562d+000/), &
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   -9.8081622255740242d-001, 1.7959173722094248d+000, &
   -2.8114002586806736d-001, 4.9304281733162542d-001 /), &
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
     6.1075315337802982d-001, 0.0000000000000000d+000/), &
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    1.2453209562519154d+000,-1.6938050883267066d+000, &
    7.0834867933145451d-001,-8.0193509602854673d-001/), &
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000d+000,0.0000000000000000d+000, &
    -3.5489771537769887d-001, 0.0000000000000000d+000/), &
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)


! ImplPeer2
  nStage=3
  CALL AllocateMethP2(ImplPeer2,nStage)
  GammaLinPeer=1.0762131636483327e+000
  cLinPeer=(/-8.9953162787855270e-002,4.6764288306976509e-001,1.0000000000000000e+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    -9.6705998384565617e-002,4.9155986452023448e-001,6.0514613386433114e-001,  &
    -7.2044747917601543e-002,3.4382532607203198e-001,7.2821942184556954e-001,  &
    -1.5011860347010186e-001,4.5820013949116545e-001,6.9191846397893642e-001/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    3.0706717256377410e-002,-4.7529918180828419e-002,8.3150421611390135e-002,  &
    2.4953721541632223e-002,-4.3235487062568945e-001,-1.2713189696161178e-001,  &
    -1.5107837606620610e-002,1.7549540296068453e-002,3.2927729561199409e-002/),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000e+000,0.0000000000000000e+000,0.0000000000000000e+000,  &
     1.1066883875756954e+000,0.0000000000000000e+000,0.0000000000000000e+000,  &
     -5.1044180289710195e-002,1.0959786066300778e+000,0.0000000000000000e+000/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
      -5.0958020347183941e-001,8.6147017101721124e-001,-1.4281031311937047e+000,  &
      -1.0432955722208659e+000,3.3277771109796825e+000,-1.9028349761626133e+000,  &
      -2.0235154419544155e+000,5.6585178730763177e+000,-4.6946411712562437e+000/),&
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0000000000000000e+000,0.0000000000000000e+000,0.0000000000000000e+000,  &
     -1.4578597262445363e+000,0.0000000000000000e+000,0.0000000000000000e+000,  &
     4.6924121735434182e-001,-4.8581564086833340e-001,0.0000000000000000e+000/),&
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)


! ImplPeer3
  nStage=3
  CALL AllocateMethP2(ImplPeer3,nStage)
  GammaLinPeer=4.2890523821343479d-001
  cLinPeer=(/-5.7773335257609537d-001,3.0026515336155035d-001,1.0000000000000000d+000/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/2.9849370979072865d-002, 1.0110127004800935d+000,-4.0862071459166316d-002, &
            1.8600165604776986d-001, 3.4486496767408092d-001,-2.0859119767698941d-001, &
           -7.8662273522080439d-002, 4.0037906629742565d-001, 2.6852004384020683d-001/),&
  SHAPE = (/nStage,nStage/) ))
  SLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/0.0000000000000000d+000,  0.0000000000000000d+000,  0.0000000000000000d+000, &
            6.7772457395513863d-001,  0.0000000000000000d+000,  0.0000000000000000d+000, &
            3.6800845100994328d-001,  4.1754712374504621d-002,  0.0000000000000000d+000/), &
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/1.5221778150165555d-001, -1.7490243196585575d-001,  1.9948646295516817d-001,  &
           -1.1442134899891926d-001,  2.5810574055617974d-001,  4.1845013423323330d-001,  &
           -5.9414843559866849d-002,  8.3741953087149990d-003,  2.4330073986195674d-001/),  &
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ 0.0000000000000000d+000,  0.0000000000000000d+000,  0.0000000000000000d+000,  &
             6.6444976945271528d-001,  0.0000000000000000d+000,  0.0000000000000000d+000,  &
             8.6700490826766648d-004,  1.1629972665721646d+000,  0.0000000000000000d+000/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/-2.3161138625337080d-001,  1.6810388718372526d-001, -3.6539773914378920d-001,   &
             2.0773818063523614d-001, -2.1865257605351296d-001, -3.3841895710590575d-001,   &
            -4.4459796629430420d-002,  7.0041764974013224d-002, -2.2411339532665692d-001/), &
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ 0.0000000000000000d+000,  0.0000000000000000d+000,  0.0000000000000000d+000, &
            -7.9571885689252275d-002,  0.0000000000000000d+000,  0.0000000000000000d+000, &
             4.3379008984240719d-001, -6.6416390107376788d-001,  0.0000000000000000d+000/), &
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  DO i=1,nStage
    LUGLinPeer(i,:)=GLinPeer(i,:)/GammaLinPeer(i)
    HLinPeer(i,:)=HLinPeer(i,:)/GammaLinPeer(i)
  END DO  
  CALL DGEFAP(LUGLinPeer,PGLinPeer)

!c=[-5.7773335257609537e-001
!    3.0026515336155035e-001
!    1.0000000000000000e+000];
!gamma=[4.2890523821343479e-001
!       4.2890523821343479e-001
!       4.2890523821343479e-001];
!B=[2.9849370979072865e-002  1.0110127004800935e+000 -4.0862071459166316e-002
!   1.8600165604776986e-001  3.4486496767408092e-001 -2.0859119767698941e-001
!  -7.8662273522080439e-002  4.0037906629742565e-001  2.6852004384020683e-001];
!S=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!    6.7772457395513863e-001  0.0000000000000000e+000  0.0000000000000000e+000
!    3.6800845100994328e-001  4.1754712374504621e-002  0.0000000000000000e+000];
!A=[ 1.5221778150165555e-001 -1.7490243196585575e-001  1.9948646295516817e-001
!   -1.1442134899891926e-001  2.5810574055617974e-001  4.1845013423323330e-001
!   -5.9414843559866849e-002  8.3741953087149990e-003  2.4330073986195674e-001];
!R=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!    6.6444976945271528e-001  0.0000000000000000e+000  0.0000000000000000e+000
!    8.6700490826766648e-004  1.1629972665721646e+000  0.0000000000000000e+000];
!G=[-2.3161138625337080e-001  1.6810388718372526e-001 -3.6539773914378920e-001
!    2.0773818063523614e-001 -2.1865257605351296e-001 -3.3841895710590575e-001
!   -4.4459796629430420e-002  7.0041764974013224e-002 -2.2411339532665692e-001];
!H=[ 0.0000000000000000e+000  0.0000000000000000e+000  0.0000000000000000e+000
!   -7.9571885689252275e-002  0.0000000000000000e+000  0.0000000000000000e+000
!    4.3379008984240719e-001 -6.6416390107376788e-001  0.0000000000000000e+000];

! JebRosRK3
  nStage=3
  CALL AllocateMethP2(JebRosRK3,nStage)
  GammaLinPeer=(/1.0d0,1.0d0,1.0d0/)
  cLinPeer=(/1.0d0/3.0d0,1.0d0/2.0d0,1.0d0/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    0.0d0,0.0d0,1.0d0, &
    0.0d0,0.0d0,1.0d0, &
    0.0d0,0.0d0,1.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  SLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    0.0d0,0.0d0,0.0d0, &
    0.0d0,0.0d0,0.0d0, &
    0.0d0,0.0d0,0.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
    0.0d0,0.0d0,1.0d0/3.0d0, &
    0.0d0,0.0d0,0.0d0, &
    0.0d0,0.0d0,0.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0d0,0.0d0,0.0d0,  &
     0.5d0,0.0d0,0.0d0,  &
     0.0d0,1.0d0,0.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
      0.0d0,0.0d0,-1.0d0, &
      0.0d0,0.0d0,-0.38888888888889d0, &
      0.0d0,0.0d0,-0.75d0/),&
  SHAPE = (/nStage,nStage/) ))
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
     0.0d0,0.0d0,0.0d0,  &
     -0.6111111111111111d0,0.0d0,0.0d0,  &
     5.25d0,-5.5d0,0.0d0/),  &
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  DO i=1,nStage
    LUGLinPeer(i,:)=GLinPeer(i,:)/GammaLinPeer(i)
    HLinPeer(i,:)=HLinPeer(i,:)/GammaLinPeer(i)
  END DO  
  CALL DGEFAP(LUGLinPeer,PGLinPeer)



! Weiner 4 stages 
  nStage=4
  CALL AllocateMethP2(JebWei,nStage)
  GammaLinPeer=1.038881826868010988d0
  cLinPeer=(/-1.0d0, -0.4142135623730950d0, 0.4142135623730950d0, 1.0d0 /)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  -0.2111331263788396d0, 2.1173151480145425d0, -0.9102083668279954d0, 0.0040263451922922d0,   &
  -0.2144686599497261d0, 1.3793792285324691d0, 0.8827147621033564d0, -1.0476253306860999d0,   &
  1.1917221221566843d0, -3.0704528383621330d0, 6.8245240487312708d0, -3.9457933325258234d0,   &
  3.1837117310664853d0, -8.6255297781651077d0, 13.4345881979835240d0, -6.9927701508849029d0/),&
  SHAPE = (/nStage,nStage/) ))
! ALinPeer=TRANSPOSE(RESHAPE( &
! SOURCE =(/ &
! -0.1075797357855660d0, 0.6270206501256210d0,  0.6270206501256204d0, -0.1075797357855657d0,  &
! -0.0160991861809259d0, 0.1829549046210377d0,  1.3478742336744878d0,  0.1099383141924152d0,  &
! -0.4748799287411599d0, 1.5995481950481749d0, -1.5606962764859644d0,  2.8891234012321538d0,  &
! -2.5873895886435259d0, 7.8312043596594227d0,-10.8457813647067190d0,  8.6408484223709312d0/),&
! SHAPE = (/nStage,nStage/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   -0.107579735597917d0, 0.627020649031923d0, 0.627020649031923d0,  -0.107579735597917d0,   &
   -0.016099186258653d0, 0.182954904918609d0, 1.347874231940116d0, 0.109938313894844d0,   &
   -0.474879927912837d0, 1.599548192407754d0,  -1.560696271658146d0, 2.889123396404335d0,   &
   -2.587389584456383d0, 7.831204347097998d0, -10.845781345583104d0, 8.640848409809500d0/), &
  SHAPE = (/nStage,nStage/) ))
  RLinPeer=0.0d0
  GLinPeer=-ALinPeer
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
  0.0d0               , 0.0d0               , 0.0d0               , 0.0d0,  &
  0.5857864376269050d0, 0.0d0               , 0.0d0               , 0.0d0,  &
  0.4142135623730950d0, 1.0000000000000000d0, 0.0d0               , 0.0d0,  &
  0.2524531042935717d0, 1.2761423749153968d0, 0.4714045207910317d0, 0.0d0/),&
  SHAPE = (/nStage,nStage/) ))
  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  HLinPeer=HLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)

! Constantinescu
  nStage=4
  CALL AllocateMethP2(JebCon,nStage)
  GammaLinPeer=0.0d0
  cLinPeer=(/0.0d0, 0.290779650375662d0, 0.625397767570505d0, 1.0d0/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   0.0d0              , 0.0d0, 0.0d0, 1.000000000000000d0,   &
   0.302830885412357d0, 0.0d0, 0.0d0, 0.697169114587643d0,   &
   0.467680228157629d0, 0.0d0, 0.0d0, 0.532319771842371d0,   &
   0.565536255223533d0, 0.0d0, 0.0d0, 0.434463744776466d0/), &
  SHAPE = (/nStage,nStage/) ))

  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   0.0d0              , 0.0d0, 0.0d0, 0.0d0,   &
   0.109139040169882d0, 0.0d0, 0.0d0, 0.0d0,   &
   0.192565654767844d0, 0.0d0, 0.0d0, 0.0d0,   &
   0.263397456904997d0, 0.0d0, 0.0d0, 0.0d0/), &
  SHAPE = (/nStage,nStage/) ))

  RLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   0.0d0              , 0.0d0              , 0.0d0              , 0.0d0,   &
   0.484471495618137d0, 0.0d0              , 0.0d0              , 0.0d0,   &
   0.369915635410953d0, 0.530596705549337d0, 0.0d0              , 0.0d0,   &
   0.301914264156994d0, 0.433057428735304d0, 0.567167105426239d0, 0.0d0/), &
  SHAPE = (/nStage,nStage/) ))
  GLinPeer=0.0d0
  HLinPeer=0.0d0

  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  LUGLinPeer=GLinPeer
  CALL DGEFAP(LUGLinPeer,PGLinPeer)


! Weiner 5 Stages
  nStage=5
  CALL AllocateMethP2(JebWei5,nStage)

  GammaLinPeer=0.5614731292097847d0
  cLinPeer=(/-1.0000000000000000d0, -0.6180339887498948d0, 0.0000000000000001d0,  &
             0.6180339887498949d0, 1.0000000000000000d0/)
  BLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   -0.1735047388107125d0, 0.7349778680204961d0, 0.9999999999999929d0, -0.7349778680204784d0, 0.1735047388107027d0, &
   -0.0163451915586648d0, 0.1067724752481665d0, 1.7520663043753579d0, -0.8656903397779923d0, 0.0231967517131300d0, &
   -0.2581940786675274d0, 0.8269231265188739d0, -0.0530331911621711d0, 2.0758515929757784d0, -1.5915474496649533d0, &
   -2.2018175902023267d0, 6.5434060185929948d0, -9.1159958402350139d0, 11.7645305530417660d0, -5.9901231411974187d0, &
   -4.7981872264635292d0, 13.9994360105275070d0, -20.1073988039752790d0, 22.5509151182283530d0, -10.6447650983170540d0/), &
  SHAPE = (/5,5/) ))
  ALinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   -0.0000000000000016d0, -0.0000000000000004d0, 0.5614731292097854d0, -0.0000000000000004d0, 0.0000000000000008d0, &
    0.0253140002388423d0, -0.0915869132553613d0, 0.6783474883938294d0, 0.3879683903990780d0, -0.0566038253164983d0, &
    0.0364745084375779d0, -0.1319660112501074d0, 0.6180339887498995d0, 0.5590169943749433d0, 0.4799136488974715d0, &
    1.0550590955420083d0, -3.2557665386009313d0, 5.8576944778707443d0, -6.3588046250141446d0, 4.8813247081620021d0, &
    3.7718926257451049d0, -11.3654068566101290d0, 18.7941230871537640d0, -21.2788589226474800d0, 12.6397231955685230d0/),&
  SHAPE = (/5,5/)))
  RLinPeer=0.0d0
  GLinPeer=-ALinPeer
  HLinPeer=TRANSPOSE(RESHAPE( &
  SOURCE =(/ &
   0.0d0               , 0.0d0               , 0.0d0               , 0.0d0               , 0.0d0,  &
   0.3819660112501052d0, 0.0d0               , 0.0d0               , 0.0d0               , 0.0d0,  &
   0.1909830056250526d0, 0.8090169943749475d0, 0.0d0               , 0.0d0               , 0.0d0,  &
   0.0786893258332632d0, 0.8726779962499650d0, 0.6666666666666669d0, 0.0d0               , 0.0d0,  &
   0.0879773408334032d0, 0.7256836610416139d0, 0.9363389981249826d0, 0.2500000000000001d0, 0.0d0/),&
  SHAPE = (/5,5/) ))

  LUALinPeer=ALinPeer
  CALL DGEFAP(LUALinPeer,PALinPeer)
  
  LUGLinPeer=GLinPeer/GammaLinPeer(1)
  CALL DGEFAP(LUGLinPeer,PGLinPeer)
  HLinPeer=HLinPeer/GammaLinPeer(1)


  nStage=5
  GeriLang5%nStage=nStage
  ALLOCATE(GeriLang5%GammaLinPeer(1:nStage))
  ALLOCATE(GeriLang5%cLinPeer(1:nStage))
  ALLOCATE(GeriLang5%ALinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%A0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%ULinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%U0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%LUULinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%LUU0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang5%PULinPeer(nStage))
  ALLOCATE(GeriLang5%PU0LinPeer(nStage))
  ALLOCATE(V(nStage,nStage))
  ALLOCATE(VInv(nStage,nStage))

  GammaLinPeer=>GeriLang5%GammaLinPeer
  cLinPeer=>GeriLang5%cLinPeer
  ULinPeer=>GeriLang5%ULinPeer
  U0LinPeer=>GeriLang5%U0LinPeer
  ALinPeer=>GeriLang5%ALinPeer
  A0LinPeer=>GeriLang5%A0LinPeer
  LUULinPeer=>GeriLang5%LUULinPeer
  LUU0LinPeer=>GeriLang5%LUU0LinPeer
  PULinPeer=>GeriLang5%PULinPeer
  PU0LinPeer=>GeriLang5%PU0LinPeer

  GammaLinPeer=0.26036881402181763d0

  cLinPeer(1)=-0.9999999999999999d0
  cLinPeer(2)=-0.6180339887498947d0
  cLinPeer(3)=-6.438136603031955d-17
  cLinPeer(4)=0.6180339887498947d0
  cLinPeer(5)=0.9999999999999999d0

  ALinPeer(1,1)=0.2603688140218176d0
  ALinPeer(1,2)=0d0
  ALinPeer(1,3)=0d0
  ALinPeer(1,4)=0d0
  ALinPeer(1,5)=0d0
  ALinPeer(2,1)=0.3819660112501065d0
  ALinPeer(2,2)=0.2603688140218176d0
  ALinPeer(2,3)=0d0
  ALinPeer(2,4)=0d0
  ALinPeer(2,5)=0d0
  ALinPeer(3,1)=0.19098300562505088d0
  ALinPeer(3,2)=0.8090169943749516d0
  ALinPeer(3,3)=0.2603688140218176d0
  ALinPeer(3,4)=0d0
  ALinPeer(3,5)=0d0
  ALinPeer(4,1)=0.0786893258332487d0
  ALinPeer(4,2)=0.8726779962499858d0
  ALinPeer(4,3)=0.6666666666666627d0
  ALinPeer(4,4)=0.2603688140218176d0
  ALinPeer(4,5)=0d0
  ALinPeer(5,1)=0.08797734083337598d0
  ALinPeer(5,2)=0.7256836610416533d0
  ALinPeer(5,3)=0.9363389981249741d0
  ALinPeer(5,4)=0.24999999999999972d0
  ALinPeer(5,5)=0.2603688140218176d0
  ALinPeer=ALinPeer/GammaLinPeer(1)

  ULinPeer(1,1)=-0.08045838833799035d0
  ULinPeer(1,2)=0.3408272023598089d0
  ULinPeer(1,3)=0.9999999999999991d0
  ULinPeer(1,4)=-0.34082720235981157d0
  ULinPeer(1,5)=0.0804583883379919d0
  ULinPeer(2,1)=-0.04670043951670445d0
  ULinPeer(2,2)=0.23017407367892606d0
  ULinPeer(2,3)=1.0955565556729843d0
  ULinPeer(2,4)=-0.2990222527535079d0
  ULinPeer(2,5)=0.0199920629183033d0
  ULinPeer(3,1)=-0.10764192107353776d0
  ULinPeer(3,2)=0.3397261103854801d0
  ULinPeer(3,3)=0.9213608411046187d0
  ULinPeer(3,4)=0.012051914199662006d0
  ULinPeer(3,5)=-0.1654969446162261d0
  ULinPeer(4,1)=-0.19552371854748002d0
  ULinPeer(4,2)=0.5025591398586282d0
  ULinPeer(4,3)=0.7158055375121766d0
  ULinPeer(4,4)=0.3205859693004278d0
  ULinPeer(4,5)=-0.3434269281237552d0
  ULinPeer(5,1)=-0.20535611654773533d0
  ULinPeer(5,2)=0.4781164684284267d0
  ULinPeer(5,3)=0.7606212122709834d0
  ULinPeer(5,4)=0.35828093159430807d0
  ULinPeer(5,5)=-0.39166249574598133d0

  A0LinPeer(1,1)=0.d0
  A0LinPeer(1,2)=0.d0
  A0LinPeer(1,3)=0.d0
  A0LinPeer(1,4)=0.d0
  A0LinPeer(1,5)=0.d0
  A0LinPeer(2,1)=0.3214781741247593d0
  A0LinPeer(2,2)=0.d0
  A0LinPeer(2,3)=0.d0
  A0LinPeer(2,4)=0.d0
  A0LinPeer(2,5)=0.d0
  A0LinPeer(3,1)=-0.09605095077445752d0
  A0LinPeer(3,2)=0.02027110096744933d0
  A0LinPeer(3,3)=0.d0
  A0LinPeer(3,4)=0.d0
  A0LinPeer(3,5)=0.d0
  A0LinPeer(4,1)=1.75183954636685d0
  A0LinPeer(4,2)=-1.7517413521179228d0
  A0LinPeer(4,3)=1.6896095404930656d0
  A0LinPeer(4,4)=0.d0
  A0LinPeer(4,5)=0.d0
  A0LinPeer(5,1)=1.356230589874878d0
  A0LinPeer(5,2)=-1.052650894187412d0
  A0LinPeer(5,3)=1.0018576030000086d0
  A0LinPeer(5,4)=0.6945627013125166d0
  A0LinPeer(5,5)=0.d0
  A0LinPeer=A0LinPeer/GammaLinPeer(1)

  U0LinPeer(1,1)=6.661338147750939d-16
  U0LinPeer(1,2)=8.881784197001252d-16
  U0LinPeer(1,3)=0.9999999999999991d0
  U0LinPeer(1,4)=1.7763568394002505d-15
  U0LinPeer(1,5)=-8.881784197001252d-16
  U0LinPeer(2,1)=-0.054257247250441176d0
  U0LinPeer(2,2)=0.25770143262530665d0
  U0LinPeer(2,3)=0.5278640450004201d0
  U0LinPeer(2,4)=0.2701626123751145d0
  U0LinPeer(2,5)=-0.0014708427503998256d0
  U0LinPeer(3,1)=0.0317249678712961d0
  U0LinPeer(3,2)=-0.13404003333938572d0
  U0LinPeer(3,3)=0.04419789000284742d0
  U0LinPeer(3,4)=0.08758280385827899d0
  U0LinPeer(3,5)=0.9705343716069632d0
  U0LinPeer(4,1)=0.24626562356188686d0
  U0LinPeer(4,2)=0.19986468684630587d0
  U0LinPeer(4,3)=0.18505308392777842d0
  U0LinPeer(4,4)=0.18509908313825818d0
  U0LinPeer(4,5)=0.18371752252577522d0
  U0LinPeer(5,1)=0.19999999999999485d0
  U0LinPeer(5,2)=0.1999999999999993d0
  U0LinPeer(5,3)=0.20000000000000284d0
  U0LinPeer(5,4)=0.1999999999999993d0
  U0LinPeer(5,5)=0.20000000000000107d0

  V(1,1)=1d0
  V(1,2)=-2.d0
  V(1,3)=2.d0
  V(1,4)=-1.3333333333333333d0
  V(1,5)=0.6666666666666666d0
  V(2,1)=1d0
  V(2,2)=-1.6180339887498947d0
  V(2,3)=1.3090169943749472d0
  V(2,4)=-0.7060113295832982d0
  V(2,5)=0.2855875819270701d0
  V(3,1)=1d0
  V(3,2)=-1.d0
  V(3,3)=0.5d0
  V(3,4)=-0.16666666666666666d0
  V(3,5)=0.041666666666666664d0
  V(4,1)=1d0
  V(4,2)=-0.3819660112501053d0
  V(4,3)=0.07294901687515778d0
  V(4,4)=-0.009288015000140213d0
  V(4,5)=0.0008869265105086758d0
  V(5,1)=1d0
  V(5,2)=-1.1102230246251565d-16
  V(5,3)=6.162975822039155d-33
  V(5,4)=-2.2807592192786735d-49
  V(5,5)=6.330378497173199d-66

  VInv(1,1)=0.d0
  VInv(1,2)=0.d0
  VInv(1,3)=0.d0
  VInv(1,4)=0.d0
  VInv(1,5)=1.d0
  VInv(2,1)=0.49999999999999867d0
  VInv(2,2)=-1.6180339887498936d0
  VInv(2,3)=3.2360679774997916d0
  VInv(2,4)=-6.854101966249688d0
  VInv(2,5)=4.736067977499792d0
  VInv(3,1)=4.236067977499776d0
  VInv(3,2)=-13.326237921249229d0
  VInv(3,3)=24.180339887498913d0
  VInv(3,4)=-29.034441853748607d0
  VInv(3,5)=13.944271909999147d0
  VInv(4,1)=14.562305898749003d0
  VInv(4,2)=-42.97871376374766d0
  VInv(4,3)=62.83281572999732d0
  VInv(4,4)=-58.68691769624703d0
  VInv(4,5)=24.27050983124837d0
  VInv(5,1)=19.416407864998682d0
  VInv(5,2)=-50.83281572999733d0
  VInv(5,3)=62.832815729997286d0
  VInv(5,4)=-50.832815729997314d0
  VInv(5,5)=19.416407864998675d0

  LUULinPeer=ULinPeer
  CALL DGEFAP(LUULinPeer,PULinPeer)
  LUU0LinPeer=U0LinPeer
  CALL DGEFAP(LUU0LinPeer,PU0LinPeer)

  nStage=4
  GeriLang4%nStage=nStage
  ALLOCATE(GeriLang4%GammaLinPeer(1:nStage))
  ALLOCATE(GeriLang4%cLinPeer(1:nStage))
  ALLOCATE(GeriLang4%ALinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%A0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%ULinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%U0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%LUULinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%LUU0LinPeer(nStage,nStage))
  ALLOCATE(GeriLang4%PULinPeer(nStage))
  ALLOCATE(GeriLang4%PU0LinPeer(nStage))
  ALLOCATE(V(nStage,nStage))
  ALLOCATE(VInv(nStage,nStage))

  GammaLinPeer=>GeriLang4%GammaLinPeer
  cLinPeer=>GeriLang4%cLinPeer
  ULinPeer=>GeriLang4%ULinPeer
  U0LinPeer=>GeriLang4%U0LinPeer
  ALinPeer=>GeriLang4%ALinPeer
  A0LinPeer=>GeriLang4%A0LinPeer
  LUULinPeer=>GeriLang4%LUULinPeer
  LUU0LinPeer=>GeriLang4%LUU0LinPeer
  PULinPeer=>GeriLang4%PULinPeer
  PU0LinPeer=>GeriLang4%PU0LinPeer

  GammaLinPeer=0.30074836217942170d0

  cLinPeer(1) = -1.d0
  cLinPeer(2) = -0.41421356237309515d0
  cLinPeer(3) = 0.41421356237309503d0
  cLinPeer(4) = 1.d0

  ALinPeer(1,1) = 0.3007483621794217d0
  ALinPeer(1,2) = 0.d0
  ALinPeer(1,3) = 0.d0
  ALinPeer(1,4) = 0.d0
  ALinPeer(2,1) = 0.5857864376269036d0
  ALinPeer(2,2) = 0.3007483621794217d0
  ALinPeer(2,3) = 0.d0
  ALinPeer(2,4) = 0.d0
  ALinPeer(3,1) = 0.4142135623730908d0
  ALinPeer(3,2) = 1.0000000000000018d0
  ALinPeer(3,3) = 0.3007483621794217d0
  ALinPeer(3,4) = 0.d0
  ALinPeer(4,1) = 0.2524531042935642d0
  ALinPeer(4,2) = 1.2761423749154017d0
  ALinPeer(4,3) = 0.4714045207910312d0
  ALinPeer(4,4) = 0.3007483621794217d0
  ALinPeer=ALinPeer/GammaLinPeer(1)

  ULinPeer(1,1) = -0.13469690321232686d0
  ULinPeer(1,2) = 1.0417758685556566d0
  ULinPeer(1,3) = 0.16533091263089172d0
  ULinPeer(1,4) = -0.07240987797422105d0
  ULinPeer(2,1) = -0.07471059619892073d0
  ULinPeer(2,2) = 0.8891009692412437d0
  ULinPeer(2,3) = 0.3291146622278427d0
  ULinPeer(2,4) = -0.14350503527016634d0
  ULinPeer(3,1) = -0.14478674709388734d0
  ULinPeer(3,2) = 1.0471709128482338d0
  ULinPeer(3,3) = 0.18675500535279332d0
  ULinPeer(3,4) = -0.08913917110714031d0
  ULinPeer(4,1) = -0.30387569710186d0
  ULinPeer(4,2) = 1.4233904702152054d0
  ULinPeer(4,3) = -0.17835570173163529d0
  ULinPeer(4,4) = 0.05884092861829071d0

  A0LinPeer(1,1) = 0.d0
  A0LinPeer(1,2) = 0.d0
  A0LinPeer(1,3) = 0.d0
  A0LinPeer(1,4) = 0.d0
  A0LinPeer(2,1) = 0.37989898732233335d0
  A0LinPeer(2,2) = 0.d0
  A0LinPeer(2,3) = 0.d0
  A0LinPeer(2,4) = 0.d0
  A0LinPeer(3,1) = -1.399670541057656d0
  A0LinPeer(3,2) = 1.5284622456353885d0
  A0LinPeer(3,3) = 0.d0
  A0LinPeer(3,4) = 0.d0
  A0LinPeer(4,1) = 1.0976310729378138d0
  A0LinPeer(4,2) = -0.5202200572599369d0
  A0LinPeer(4,3) = 1.422588984322122d0
  A0LinPeer(4,4) = 0.d0
  A0LinPeer=A0LinPeer/GammaLinPeer(1)

  U0LinPeer(1,1) = -0.10355339059327384d0
  U0LinPeer(1,2) = 0.6035533905932735d0
  U0LinPeer(1,3) = 0.6035533905932744d0
  U0LinPeer(1,4) = -0.10355339059327406d0
  U0LinPeer(2,1) = 0.0035533905932736073d0
  U0LinPeer(2,2) = 0.38933982822017876d0
  U0LinPeer(2,3) = 0.4035533905932739d0
  U0LinPeer(2,4) = 0.20355339059327354d0
  U0LinPeer(3,1) = -0.6015649299761381d0
  U0LinPeer(3,2) = 0.43286269751065576d0
  U0LinPeer(3,3) = 0.5216025586555995d0
  U0LinPeer(3,4) = 0.6470996738098833d0
  U0LinPeer(4,1) = 0.24999999999999778d0
  U0LinPeer(4,2) = 0.25d0
  U0LinPeer(4,3) = 0.25d0
  U0LinPeer(4,4) = 0.2499999999999991d0

  LUULinPeer=ULinPeer
  CALL DGEFAP(LUULinPeer,PULinPeer)
  LUU0LinPeer=U0LinPeer
  CALL DGEFAP(LUU0LinPeer,PU0LinPeer)



END SUBROUTINE MethodsLinP

SUBROUTINE AllocateMethP2(Method,nStage)

  TYPE(LinP2Method_T) :: Method
  INTEGER :: nStage

  Method%nStage=nStage 
  ALLOCATE(Method%GammaLinPeer(1:nStage))
  ALLOCATE(Method%cLinPeer(1:nStage))
  ALLOCATE(Method%GLinPeer(nStage,nStage))
  ALLOCATE(Method%HLinPeer(nStage,nStage))
  ALLOCATE(Method%BLinPeer(nStage,nStage))
  ALLOCATE(Method%ALinPeer(nStage,nStage))
  ALLOCATE(Method%RLinPeer(nStage,nStage))
  ALLOCATE(Method%SLinPeer(nStage,nStage))
  ALLOCATE(Method%LUGLinPeer(nStage,nStage))
  ALLOCATE(Method%LUALinPeer(nStage,nStage))
  ALLOCATE(Method%PGLinPeer(nStage))
  ALLOCATE(Method%PALinPeer(nStage))
  
  GammaLinPeer=>Method%GammaLinPeer
  cLinPeer=>Method%cLinPeer
  GLinPeer=>Method%GLinPeer
  HLinPeer=>Method%HLinPeer
  BLinPeer=>Method%BLinPeer
  ALinPeer=>Method%ALinPeer
  RLinPeer=>Method%RLinPeer
  SLinPeer=>Method%SLinPeer
  SLinPeer=0.0d0
  LUGLinPeer=>Method%LUGLinPeer
  LUALinPeer=>Method%LUALinPeer
  PGLinPeer=>Method%PGLinPeer
  PALinPeer=>Method%PALinPeer

END SUBROUTINE AllocateMethP2

SUBROUTINE MultVec(dt,LU,Pivot,VecVelC)

  REAL(RealKind) :: dt
  REAL(RealKind) :: LU(:,:)
  INTEGER :: Pivot(:)
  TYPE (VecVector4Cell_T), POINTER :: VecVelC(:)

  INTEGER :: i,j,n
  TYPE (VecVector4Cell_T), POINTER :: VecVelCC(:)

  n=UBOUND(LU,1)
  DO i=1,n
    CALL ScaleV(dt*LU(i,i),VecVelC(i)%Vec)
    DO j=i+1,n
      CALL Axpy(dt*LU(i,j),VecVelC(j)%Vec,VecVelC(i)%Vec)
    END DO
  END DO
  DO i=n,1,-1
    DO j=1,i-1
      CALL Axpy(LU(i,j),VecVelC(j)%Vec,VecVelC(i)%Vec)
    END DO
  END DO
  ALLOCATE(VecVelCC(n))
  VecVelCC=VecVelC
  DO i=1,n
    j=Pivot(i)
    VecVelC(j)=VecVelCC(i)
  END DO
  DEALLOCATE(VecVelCC)

END SUBROUTINE MultVec

SUBROUTINE MultVecF(dt,LU,Pivot,VecVelF)

  REAL(RealKind) :: dt
  REAL(RealKind) :: LU(:,:)
  INTEGER :: Pivot(:)
  TYPE (VecVelocityFace_T), POINTER :: VecVelF(:)

  INTEGER :: i,j,n
  TYPE (VecVelocityFace_T), POINTER :: VecVelFF(:)

  n=UBOUND(LU,1)
  DO i=1,n
    CALL ScaleV(dt*LU(i,i),VecVelF(i)%VecF)
    DO j=i+1,n
      CALL Axpy(dt*LU(i,j),VecVelF(j)%VecF,VecVelF(i)%VecF)
    END DO
  END DO
  DO i=n,1,-1
    DO j=1,i-1
      CALL Axpy(LU(i,j),VecVelF(j)%VecF,VecVelF(i)%VecF)
    END DO
  END DO
  ALLOCATE(VecVelFF(n))
  VecVelFF=VecVelF
  DO i=1,n
    j=Pivot(i)
    VecVelF(j)=VecVelFF(i)
  END DO
  DEALLOCATE(VecVelFF)
    

END SUBROUTINE MultVecF

SUBROUTINE MultVecR(dt,LU,Pivot,VecR)

  REAL(RealKind) :: dt
  REAL(RealKind) :: LU(:,:)
  INTEGER :: Pivot(:)
  TYPE (R_T), POINTER :: VecR(:)

  INTEGER :: i,j,n
  TYPE (R_T), POINTER :: VecRR(:)

  n=UBOUND(LU,1)
  DO i=1,n
    VecR(i)%x=dt*LU(i,i)*VecR(i)%x
    DO j=i+1,n
      VecR(i)%x= VecR(i)%x+dt*LU(i,j)*VecR(j)%x
    END DO
  END DO
  DO i=n,1,-1
    DO j=1,i-1
      VecR(i)%x= VecR(i)%x+LU(i,j)*VecR(j)%x
    END DO
  END DO
  ALLOCATE(VecRR(n))
  VecRR=VecR
  DO i=1,n
    j=Pivot(i)
    VecR(j)=VecRR(i)
  END DO
  DEALLOCATE(VecRR)


END SUBROUTINE MultVecR

SUBROUTINE MultV(dt,A,w)

  REAL(RealKind) :: dt
  REAL(RealKind) :: A(:,:)
  REAL(RealKind) :: w(:)
  INTEGER :: i,j,n
  REAL(RealKind) :: ww(SIZE(w))
  n=UBOUND(A,1)
  ww=w
  DO i=1,n
    w(i)=0.0d0
    DO j=1,n
      w(i)=w(i)+dt*A(i,j)*ww(j)
    END DO
  END DO
END SUBROUTINE MultV


END MODULE LinPeerMethods_Mod

